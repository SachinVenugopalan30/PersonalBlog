# üöÄ Deployment Guide

This project supports multiple deployment methods with Docker and automated CI/CD via GitHub Actions.

## üìã Prerequisites

- Docker and Docker Compose installed
- A server with public IP address
- Domain name pointing to your server
- GitHub repository with Actions enabled

## üèóÔ∏è Deployment Methods

### 1. Quick Local Deployment

For testing or development deployment on your server:

```bash
# Clone the repository
git clone https://github.com/SachinVenugopalan30/PersonalBlog.git
cd PersonalBlog

# Make deploy script executable
chmod +x deploy.sh

# Deploy with local build
./deploy.sh yourdomain.com your-email@example.com
```

### 2. Production Deployment with CI/CD

For production deployment using pre-built images from GitHub Container Registry:

```bash
# Deploy with production image
./deploy.sh --prod yourdomain.com your-email@example.com
```

## ‚öôÔ∏è GitHub Actions Setup

### Required Secrets

Add these secrets to your GitHub repository (`Settings > Secrets and variables > Actions`):

| Secret Name | Description | Example |
|-------------|-------------|---------|
| `HOST` | Your server's IP address or hostname | `123.456.789.0` |
| `USERNAME` | SSH username for your server | `ubuntu` or `root` |
| `SSH_PRIVATE_KEY` | SSH private key for server access | `-----BEGIN OPENSSH PRIVATE KEY-----...` |
| `PORT` | SSH port (optional, defaults to 22) | `22` |
| `DEPLOY_PATH` | Path to your project on server | `/opt/PersonalBlog` |

### SSH Key Setup

1. Generate SSH key pair on your local machine:
```bash
ssh-keygen -t ed25519 -C "github-actions@yourdomain.com"
```

2. Copy public key to your server:
```bash
ssh-copy-id -i ~/.ssh/id_ed25519.pub user@your-server
```

3. Add private key content to GitHub Secrets as `SSH_PRIVATE_KEY`

### Server Preparation

On your server, prepare the deployment directory:

```bash
# Create deployment directory
sudo mkdir -p /opt/PersonalBlog
sudo chown $USER:$USER /opt/PersonalBlog

# Clone repository
cd /opt/PersonalBlog
git clone https://github.com/SachinVenugopalan30/PersonalBlog.git .

# Create Docker network
docker network create traefik

# Copy environment template
cp .env.example .env
# Edit .env with your domain and email
nano .env
```

## üîÑ CI/CD Workflow

The GitHub Actions workflow (`/.github/workflows/deploy.yml`) automatically:

1. **Test**: Runs on every push/PR
   - Installs dependencies with Bun
   - Builds the project
   - Validates build output

2. **Build & Push**: On main branch pushes
   - Builds Docker image
   - Pushes to GitHub Container Registry
   - Tags with commit SHA and 'latest'

3. **Deploy**: On main branch pushes
   - SSHs to your server
   - Pulls latest changes
   - Updates Docker Compose to use new image
   - Restarts containers
   - Cleans up old images

## üê≥ Docker Configuration

### Files Overview

- `Dockerfile`: Multi-stage build using Bun and Nginx
- `docker-compose.yml`: Local development setup
- `docker-compose.prod.yml`: Production setup with environment variables
- `nginx.conf`: Optimized Nginx configuration

### Container Features

- **Bun**: Fast package manager and runtime
- **Multi-stage build**: Smaller production image
- **Nginx**: High-performance static file serving
- **Traefik**: Automatic HTTPS with Let's Encrypt
- **Health checks**: Container monitoring
- **Security headers**: Enhanced security

## üîß Manual Deployment Commands

### Local Development
```bash
# Build and run locally
docker-compose up --build -d

# View logs
docker-compose logs -f

# Stop services
docker-compose down
```

### Production Deployment
```bash
# Pull latest image and deploy
docker pull ghcr.io/sachinvenugopalan30/personalblog:latest
docker-compose -f docker-compose.prod.yml up -d

# Check status
docker-compose -f docker-compose.prod.yml ps

# View logs
docker-compose -f docker-compose.prod.yml logs -f
```

## üåê Domain Configuration

### DNS Setup
Point your domain's A record to your server:
```
Type: A
Name: @ (or subdomain)
Value: YOUR_SERVER_IP
TTL: 300
```

### SSL Certificates
- Automatically generated by Let's Encrypt via Traefik
- Auto-renewal enabled
- Certificates stored in `./letsencrypt/`

## üìä Monitoring

### Health Checks
- Container health monitoring enabled
- Nginx health endpoint: `http://yourdomain.com/health`
- Traefik dashboard: `http://yourdomain.com:8080`

### Logs
```bash
# Application logs
docker-compose logs -f portfolio

# Traefik logs
docker-compose logs -f traefik

# Access logs
tail -f logs/access.log
```

## üîß Troubleshooting

### Common Issues

1. **SSL Certificate Issues**
   ```bash
   # Check certificate status
   docker-compose exec traefik cat /letsencrypt/acme.json
   
   # Restart Traefik
   docker-compose restart traefik
   ```

2. **Container Not Starting**
   ```bash
   # Check logs
   docker-compose logs portfolio
   
   # Rebuild container
   docker-compose up --build --force-recreate -d
   ```

3. **DNS Not Resolving**
   ```bash
   # Test DNS
   nslookup yourdomain.com
   dig yourdomain.com
   ```

### Update Deployment
```bash
# Pull changes and redeploy
git pull origin main
./deploy.sh --prod yourdomain.com your-email@example.com
```

## üîí Security

### Firewall Configuration
```bash
# Allow HTTP and HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Restrict SSH (optional)
sudo ufw allow from your-ip to any port 22
```

### Production Security
- Traefik dashboard should be restricted in production
- Regular security updates recommended
- Monitor access logs for suspicious activity
- Consider using fail2ban for additional protection

## üìà Performance

### Optimizations Included
- Gzip compression
- Static asset caching (1 year)
- Browser caching headers
- Optimized Nginx configuration
- Multi-stage Docker build
- Container resource limits

### Monitoring Performance
```bash
# Check resource usage
docker stats

# Monitor response times
curl -w "@curl-format.txt" -o /dev/null -s "https://yourdomain.com"
```

## üÜò Support

If you encounter issues:

1. Check the troubleshooting section above
2. Review Docker and application logs
3. Verify DNS and firewall configuration
4. Check GitHub Actions workflow logs
5. Ensure all secrets are properly configured

For additional help, check the repository issues or create a new one with:
- Error messages
- Deployment logs
- System information
- Steps to reproduce
